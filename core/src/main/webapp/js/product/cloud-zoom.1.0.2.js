(function(e){function t(e){for(var t=1;t<arguments.length;t++){e=e.replace("%"+(t-1),arguments[t])}return e}function n(n,r){var i=e("img",n);var s;var o;var u=null;var a=null;var f=null;var l=null;var c=null;var h=null;var p;var d=0;var v,m;var g=0;var y=0;var b=0;var w=0;var E=0;var S,x;var T=this,N;var C=function(){if(h!==null){h.remove();h=null}};this.removeBits=function(){if(f){f.remove();f=null}if(l){l.remove();l=null}if(c){c.remove();c=null}C();e(".cloud-zoom-loading",n.parent()).remove()};this.destroy=function(){n.data("zoom",null);if(a){a.unbind();a.remove();a=null}if(u){u.remove();u=null}this.removeBits()};this.fadedOut=function(){if(u){u.remove();u=null}this.removeBits()};this.controlLoop=function(){if(f){var e=S-i.offset().left-v*.5>>0;var t=x-i.offset().top-m*.5>>0;if(e<0){e=0}else if(e>i.outerWidth()-v){e=i.outerWidth()-v}if(t<0){t=0}else if(t>i.outerHeight()-m){t=i.outerHeight()-m}f.css({left:e,top:t});f.css("background-position",-e+"px "+ -t+"px");g=e/i.outerWidth()*p.width>>0;y=t/i.outerHeight()*p.height>>0;w+=(g-w)/r.smoothMove;b+=(y-b)/r.smoothMove;u.css("background-position",-(w>>0)+"px "+(-(b>>0)+"px"))}d=setTimeout(function(){T.controlLoop()},30)};this.init2=function(e,t){E++;if(t===1){p=e}if(E===2){this.init()}};this.init=function(){e(".cloud-zoom-loading",n.parent()).remove();a=n.parent().append(t("<div class='mousetrap' style='z-index:999;position:absolute;width:%0px;height:%1px;left:%2px;top:%3px;'></div>",i.outerWidth(),i.outerHeight(),0,0)).find(":last");a.bind("mousemove",this,function(e){S=e.pageX;x=e.pageY});a.bind("mouseleave",this,function(e){clearTimeout(d);if(f){f.fadeOut(299)}if(l){l.fadeOut(299)}if(c){c.fadeOut(299)}u.fadeOut(300,function(){T.fadedOut()});return false});a.bind("mouseenter",this,function(s){S=s.pageX;x=s.pageY;N=s.data;if(u){u.stop(true,false);u.remove()}var o=r.adjustX,d=r.adjustY;var g=i.outerWidth();var y=i.outerHeight();var b=r.zoomWidth;var w=r.zoomHeight;if(r.zoomWidth=="auto"){b=g}if(r.zoomHeight=="auto"){w=y}var E=n.parent();switch(r.position){case"top":d-=w;break;case"right":o+=g;break;case"body":d=i.offset().top;o=g+i.offset().left+3;E=e(r.position);break;case"bottom":d+=y;break;case"left":o-=b;break;case"inside":b=g;w=y;break;default:E=e("#"+r.position);if(!E.length){E=n;o+=g;d+=y}else{b=E.innerWidth();w=E.innerHeight()}}u=E.append(t('<div id="cloud-zoom-big" class="cloud-zoom-big" style="display:none;position:absolute;left:%0px;top:%1px;width:%2px;height:%3px;background-image:url(\'%4\');z-index:999;"></div>',o+2,e(".czbox").offset().top,b,w,p.src)).find(":last");if(e.browser.msie&&e.browser.version<7){h=e('<iframe frameborder="0" src="#"></iframe>').css({position:"absolute",left:o,top:d,zIndex:99,width:b,height:w}).insertBefore(u)}u.fadeIn(500);if(f){f.remove();f=null}v=i.outerWidth()/p.width*u.width();m=i.outerHeight()/p.height*u.height();f=n.append(t("<div class = 'cloud-zoom-lens' style='display:none;z-index:98;position:absolute;width:%0px;height:%1px;'></div>",v,m)).find(":last");a.css("cursor",f.css("cursor"));var T=false;if(r.tint){f.css("background",'url("'+i.attr("src")+'")');l=n.append(t('<div style="display:none;position:absolute; left:0px; top:0px; width:%0px; height:%1px; background-color:%2;" />',i.outerWidth(),i.outerHeight(),r.tint)).find(":last");l.css("opacity",r.tintOpacity);T=true;l.fadeIn(500)}if(r.softFocus){f.css("background",'url("'+i.attr("src")+'")');c=n.append(t('<div style="position:absolute;display:none;top:2px; left:2px; width:%0px; height:%1px;" />',i.outerWidth()-2,i.outerHeight()-2,r.tint)).find(":last");c.css("background",'url("'+i.attr("src")+'")');c.css("opacity",.5);T=true;c.fadeIn(500)}if(!T){f.css("opacity",r.lensOpacity)}if(r.position!=="inside"){f.fadeIn(500)}N.controlLoop();return})};s=new Image;e(s).load(function(){T.init2(this,0)});s.src=i.attr("src");o=new Image;e(o).load(function(){if(this.width>=700||this.height>=700){T.init2(this,1)}});o.src=i.attr("src").replace("_310x310","_750x750");o.src=o.src.replace("thumb.ximgs.net","content.ximgs.net");}e(document).ready(function(){e(".cloud-zoom, .cloud-zoom-gallery").CloudZoom()});e.fn.CloudZoom=function(t){this.each(function(){var r,i;r={zoomHeight:314,zoomWidth:430,adjustX:10,adjustY:-4,position:"body"};if(e(this).is(".cloud-zoom")){e(this).css({display:"table-cell","vertical-align":"middle","text-align":"center"});if(e(this).parent().attr("id")!="wrap"){e(this).wrap('<div id="wrap" style="top:0px;z-index:999;position:relative;"></div>')}i=e.extend({},e.fn.CloudZoom.defaults,t);i=e.extend({},i,r);e(this).data("zoom",new n(e(this),i))}});return this};e.fn.CloudZoom.defaults={zoomWidth:"auto",zoomHeight:"auto",position:"right",tint:false,tintOpacity:.5,lensOpacity:.5,softFocus:false,smoothMove:3,showTitle:true,titleOpacity:.5,adjustX:0,adjustY:0}})(jQuery)